# Issue #102: Imported quizzes are saved twice when user clicks 'Play Now'

**Status:** In Progress
**Branch:** `fix/issue-102-import-quiz-duplication`
**Created:** 2026-01-09

---

## Problem Statement

When a user clicks a shared quiz link and chooses "Play Now", the quiz gets saved twice to IndexedDB, resulting in duplicate entries in the quiz list.

## Root Cause Analysis

**State key mismatch between ImportView and ResultsView:**

1. `ImportView.handlePlayNow()` saves the quiz via `saveImportedQuiz()` which returns a session ID
2. `ImportView.startQuiz()` stores this ID as `state.set('lastSessionId', ...)`
3. When quiz ends, `ResultsView.saveQuizSession()` checks for `state.get('replaySessionId')`
4. Since `replaySessionId` is never set (only `lastSessionId`), ResultsView doesn't recognize this as an existing quiz
5. ResultsView creates a NEW session, duplicating the quiz

**Code References:**
- `src/views/ImportView.js:255` - Sets `lastSessionId`
- `src/views/ResultsView.js:221` - Checks `replaySessionId`

## Solution Design

Change the state key in `ImportView.startQuiz()` from `lastSessionId` to `replaySessionId`.

This will make ResultsView recognize the imported quiz as an existing session and update it instead of creating a duplicate.

## Files to Change

| File | Change |
|------|--------|
| `src/views/ImportView.js` | Line 255: Change `lastSessionId` to `replaySessionId` |

## Testing Plan

- [x] Write failing E2E test that reproduces the bug
- [ ] Implement fix
- [ ] Verify E2E test passes
- [ ] Run full test suite
- [ ] Manual verification

## Implementation Log

### Step 1: Write Failing Test
- Adding E2E test in `tests/e2e/share.spec.js`
- Test: import quiz via "Play Now" → complete quiz → verify only 1 entry in history

### Step 2: Implement Fix
- Change line 255 in `src/views/ImportView.js`

### Step 3: Verify
- Run E2E tests
- Run unit tests

---

**Last Updated:** 2026-01-09
