# Issue #37: Show estimated time remaining during quiz generation

**Issue:** https://github.com/vitorsilva/saberloop/issues/37
**Branch:** `fix/issue-37-loading-countdown`
**Created:** 2025-12-26

---

## Problem Statement

Quiz generation takes ~60 seconds on average (based on telemetry). Users don't know how long to wait, which may lead to abandonment or frustration.

## Root Cause Analysis

The current LoadingView shows rotating messages but provides no indication of expected wait time. Users have no way to know if the process is taking longer than normal or how much longer they need to wait.

## Solution Design

### Changes to LoadingView.js

1. **Add constants** for easy configuration:
   ```javascript
   const ESTIMATED_DURATION_SECONDS = 60;
   const SHOW_COUNTDOWN_AFTER_SECONDS = 20;
   ```

2. **Add countdown timer** that starts when quiz generation begins:
   - First 20 seconds: No countdown shown (current behavior)
   - 20-60 seconds: Show "About Xs remaining..." below rotating message
   - After 60 seconds: Show "Almost done..." and add extended messages to rotation

3. **Extended messages** added after 60 seconds:
   - "Teaching an AI isn't easy..."
   - "Our AI is thinking extra hard..."

### UI Layout

```
┌─────────────────────────────────────────┐
│           [Spinning Animation]          │
│                                         │
│         Generating quiz for             │
│         "World War II"                  │
│         Middle School Level             │
│                                         │
│    "Consulting our AI teacher..."       │  <- Rotating message
│                                         │
│      About 35 seconds remaining...      │  <- NEW: Countdown (after 20s)
│                                         │
│            • • •                        │
│                                         │
│            Cancel                       │
└─────────────────────────────────────────┘
```

## Files to Change

| File | Changes |
|------|---------|
| `src/views/LoadingView.js` | Add timer, countdown display, extended messages |
| `tests/e2e/app.spec.js` | Add E2E test for countdown feature |

## Testing Plan

### E2E Test
- Navigate to loading view
- After 20 seconds, verify countdown text appears
- Verify countdown decrements each second

### Manual Testing
- Start quiz generation, wait 20+ seconds, verify countdown
- Wait 60+ seconds, verify "Almost done..." and extended messages

## Acceptance Criteria

- [ ] No countdown shown in first 20 seconds
- [ ] After 20s, countdown appears and updates every second
- [ ] When countdown reaches 0, shows "Almost done..."
- [ ] After 60s, extended messages added to rotation
- [ ] `ESTIMATED_DURATION_SECONDS` constant is easy to change
- [ ] Timer cleaned up properly on cancel or navigation
- [ ] Works correctly on repeated quiz generations
- [ ] E2E test passes

---

## Implementation Log

### Step 1: Before Screenshot
- [x] Skipped - LoadingView requires OpenRouter connection to stay visible

### Step 2: Write Failing Test
- [x] Created 2 E2E tests that check for countdown and extended messages
- [x] Tests use `page.addInitScript` for config overrides
- [x] Tests use `window.MOCK_API_DELAY_MS` for API delay

### Step 3: Implementation
- [x] Add constants via `getConfig()` function
- [x] Add elapsed time tracking (`this.elapsedSeconds`)
- [x] Add countdown display element (`#countdownText`)
- [x] Add logic to show countdown after configurable delay
- [x] Add extended messages after timeout
- [x] Clean up timers properly in `cleanup()`

### Step 4: After Screenshot
- [x] Test video captured: `docs/issues/37-countdown-demo.webm`

### Step 5: Create PR
- [x] All 36 tests pass
- [ ] PR created
