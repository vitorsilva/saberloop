# Issue #100: E2E Test - Dark mode brightness check fails

**Status:** âœ… Complete
**Branch:** `fix/issue-100-dark-mode-test`
**PR:** #104 (merged)
**Created:** 2026-01-09

---

## Problem Statement

The E2E test `should display quiz correctly in dark mode` consistently fails in CI with:
```
Error: expect(received).toBeLessThan(expected)
Expected: < 128
Received:   249
```

The test expects a dark background but gets a light one.

## Root Cause Analysis

The test uses `page.emulateMedia({ colorScheme: 'dark' })` to enable dark mode, but the app uses **Tailwind's class-based dark mode**, not CSS media queries.

- `emulateMedia` only affects `prefers-color-scheme` media query
- The app toggles dark mode by adding/removing the `dark` class on `<html>`
- The app doesn't respond to `prefers-color-scheme`

**Code Reference:**
- `src/services/theme-manager.js:44-52` - Dark mode is applied via `root.classList.add('dark')`

## Solution

Replace `page.emulateMedia({ colorScheme: 'dark' })` with direct class manipulation:
```javascript
await page.evaluate(() => {
  document.documentElement.classList.add('dark');
});
```

## Files to Change

| File | Change |
|------|--------|
| `tests/e2e/app.spec.js` | Line 633: Replace emulateMedia with classList.add('dark') |

## Testing Plan

- [x] Run failing test to confirm it fails
- [x] Apply fix
- [x] Run test to confirm it passes
- [x] Deployed to production

---

**Last Updated:** 2026-01-09
