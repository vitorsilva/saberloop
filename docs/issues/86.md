# Issue #86: Shared quiz via URL shows all answers as wrong (correctIndex is undefined)

## Problem Statement

When playing a quiz that was shared via URL link, **all answers show as incorrect** on the results page, regardless of what the user selects. Investigation reveals that the `correctIndex` property is `undefined` for all questions in IndexedDB after importing a shared quiz.

## Root Cause Analysis

**Property naming inconsistency** between different parts of the codebase:

| Component | Property Name Used | Purpose |
|-----------|-------------------|---------|
| `api.real.js` (AI response) | `correct` | AI returns this |
| `ResultsView.js` | `question.correct` | Checks answer correctness |
| `shuffle.js` | `question.correct` | Shuffles options |
| `quiz-serializer.js` | `correctIndex` | Serializes for URL sharing |
| `types.js` | `correctIndex` | Type definition |

### Bug Flow

```
1. Quiz generated by AI → uses `correct` property
2. User plays quiz → works (code uses `question.correct`)
3. User shares quiz → serializer reads `q.correctIndex` (undefined!)
4. Shared URL contains questions with undefined correctIndex
5. Quiz imported → saved with correctIndex: undefined
6. User plays imported quiz
7. Results page reads `question.correct` → undefined → all wrong
```

## Solution Design

### Option A: Normalize property name to `correct` (Recommended)

Update `quiz-serializer.js` to use `correct` instead of `correctIndex`:
- Matches existing API response and view code
- Minimal change, single file modification
- Less risky

### Option B: Normalize property name to `correctIndex`

Update all files to use `correctIndex`:
- More changes required (api.real.js, ResultsView.js, shuffle.js, etc.)
- More risky due to wider impact
- Would need to update all tests

**Decision: Option A** - Align serializer with existing code convention.

## Files to Change

1. `src/services/quiz-serializer.js` - Change `correctIndex` to `correct`
2. `src/services/quiz-serializer.test.js` - Update tests to use `correct`
3. `src/services/quiz-share.test.js` - Update tests to use `correct`
4. `src/services/quiz-import.test.js` - Update tests to use `correct`
5. `src/types.js` - Update type definition to use `correct`

## Testing Plan

### 1. Write failing test first
- [ ] Create test that serializes a quiz with `correct` property
- [ ] Assert that deserialized quiz has `correct` value preserved
- [ ] Run test → expect failure (proves bug exists)

### 2. Fix the code
- [ ] Update `quiz-serializer.js` QUESTION_KEY_MAP to use `correct`
- [ ] Update `toShortKeys()` to read `q.correct`
- [ ] Update `toFullKeys()` to write `correct` property

### 3. Update all tests
- [ ] Update quiz-serializer.test.js
- [ ] Update quiz-share.test.js
- [ ] Update quiz-import.test.js
- [ ] Update types.js

### 4. Verify fix
- [ ] Run all unit tests
- [ ] Run E2E tests
- [ ] Manual test: create quiz, share, import, play → answers should be correct

## Before/After Screenshots

**Before (bug):** User provided screenshot showing `correctIndex: undefined` in IndexedDB

**After:** (To be captured after fix)

## Implementation Progress

- [ ] Plan created
- [ ] Failing test written
- [ ] Fix implemented
- [ ] Tests passing
- [ ] PR created
