appId: com.saberloop.app
---
# Test 07: Offline Mode
# Verifies app works offline - can access saved quizzes
# NOTE: This test uses airplane mode toggle which may be flaky in CI

# Launch and navigate to home
- launchApp
- runFlow:
    file: _shared/navigate-home.yaml

# Verify we're online - Start New Quiz button should be visible
- assertVisible:
    text: ".*Start.*Quiz.*|.*Generate.*Quiz.*"

- takeScreenshot: 07-online-state

# Enable airplane mode (go offline)
- toggleAirplaneMode

# Wait a moment for network state change
- extendedWaitUntil:
    timeout: 3000
    visible: ".*"

- takeScreenshot: 07-offline-state

# Tap on a saved quiz from Recent Topics (should work offline)
- tapOn:
    text: ".*Solar System.*|.*Famous Scientists.*|.*Basic Math.*|.*What makes.*|.*How do.*"

# Wait for quiz to load
- extendedWaitUntil:
    visible: "Question.*of.*"
    timeout: 10000

- takeScreenshot: 07-offline-quiz-started

# Answer a couple questions to verify quiz works offline
- tapOn:
    text: "A\\).*"
- tapOn:
    text: ".*Submit.*|.*Next.*"

- tapOn:
    text: "A\\).*"
    optional: true
- tapOn:
    text: ".*Submit.*|.*Next.*"
    optional: true

- takeScreenshot: 07-offline-quiz-progress

# Go back to home
- tapOn: "Home"

# Handle confirmation dialog if it appears
- tapOn:
    text: "OK"
    optional: true

# Disable airplane mode (go back online)
- toggleAirplaneMode

# Wait for home screen
- extendedWaitUntil:
    visible: ".*Saberloop.*|.*Welcome back.*"
    timeout: 5000

- takeScreenshot: 07-back-online

# Verify app is functional again
- assertVisible:
    text: ".*Start.*Quiz.*|.*Generate.*Quiz.*|.*Recent.*Topics.*"
