appId: com.saberloop.app
---
# Test 14: Quiz Sharing - Open Modal from History Page
# Corresponds to E2E test: "should open Share Quiz modal from history page"

# Launch and navigate to home
- launchApp
- runFlow:
    file: _shared/navigate-home.yaml

# First complete a quiz to have something in history
- tapOn:
    text: ".*Solar System.*|.*Basic Math.*|.*Famous Scientists.*"

- extendedWaitUntil:
    visible: "Question.*of.*"
    timeout: 10000

- tapOn:
    text: "A\\).*"
- tapOn:
    text: ".*Submit.*|.*Next.*"

- tapOn:
    text: "A\\).*"
    optional: true
- tapOn:
    text: ".*Submit.*|.*Next.*"
    optional: true

- tapOn:
    text: "A\\).*"
    optional: true
- tapOn:
    text: ".*Submit.*|.*Next.*"
    optional: true

- tapOn:
    text: "A\\).*"
    optional: true
- tapOn:
    text: ".*Submit.*|.*Next.*"
    optional: true

- tapOn:
    text: "A\\).*"
    optional: true
- tapOn:
    text: ".*Submit.*|.*Next.*"
    optional: true

- extendedWaitUntil:
    visible: ".*Results.*|.*Score.*|.*%.*"
    timeout: 10000

# Navigate to Topics/History page via bottom nav
- tapOn:
    text: "Topics"

- extendedWaitUntil:
    visible: ".*Quiz History.*|.*Topics.*|.*quizzes.*"
    timeout: 5000

- takeScreenshot: 14-history-page

# Tap share button (aria-label "Share quiz")
- tapOn:
    text: ".*Share quiz.*"

# Wait for modal to appear
- extendedWaitUntil:
    visible: ".*Copy.*Link.*|.*Copy.*"
    timeout: 5000

- takeScreenshot: 14-modal-from-history

# Verify modal elements
- assertVisible:
    text: ".*Share Quiz.*"

- assertVisible:
    text: ".*Copy.*Link.*|.*Copy.*"

# Verify still on history page (URL didn't change)
# Close modal to verify
- tapOn:
    text: ".*Close.*"

- extendedWaitUntil:
    notVisible: ".*Copy.*Link.*"
    timeout: 3000

# Verify still on history page
- assertVisible:
    text: ".*Quiz History.*|.*Topics.*|.*quizzes.*"

- takeScreenshot: 14-still-on-history
